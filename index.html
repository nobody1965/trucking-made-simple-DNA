<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trucking Made Simple</title>

  <style>
    :root{
      --bg:#0b0c10;
      --card:#121420;
      --text:#e9e9f1;
      --muted:#aeb2c7;
      --line:#242844;
      --pill:#1a1f34;
      --pillActive:#2a3270;
      --btn:#1a1f34;
      --btnHover:#232a4a;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    /* Top scroll tabs (YouTube-style) */
    .topTabs{
      position: sticky;
      top: 0;
      z-index: 50;
      display:flex;
      gap:8px;
      padding:10px;
      overflow-x:auto;
      background: rgba(11,12,16,.95);
      border-bottom:1px solid var(--line);
      -webkit-overflow-scrolling: touch;
    }
    .tabBtn{
      flex: 0 0 auto;
      border:1px solid var(--line);
      background:var(--pill);
      color:var(--text);
      padding:10px 12px;
      border-radius:999px;
      cursor:pointer;
      user-select:none;
      white-space:nowrap;
      font-weight:600;
    }
    .tabBtn.active{
      background:var(--pillActive);
      border-color:#3c46a8;
    }

    /* Main card */
    .wrap{ max-width:980px; margin: 14px auto; padding: 0 12px; }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:16px;
      padding:14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .headerBar{ margin-bottom:8px; }
    h1{ margin:4px 0 0; font-size:22px; }
    .sub{ color:var(--muted); margin:6px 0 10px; font-size:14px; }
    .headerDivider, .divider{ height:1px; background:var(--line); margin:12px 0; }

    .badge{
      display:inline-block;
      background:#0f1326;
      border:1px solid var(--line);
      padding:8px 10px;
      border-radius:999px;
      color:var(--muted);
      font-size:12px;
    }

    /* Pages */
    .tabPage{ display:none; }
    .tabPage.activePage{ display:block; }

    /* Sections (open/close) */
    .sectionBtn{
      width:100%;
      text-align:left;
      border:1px solid var(--line);
      background:var(--btn);
      color:var(--text);
      padding:12px;
      border-radius:12px;
      cursor:pointer;
      font-weight:700;
      margin-top:10px;
    }
    .sectionBtn:hover{ background:var(--btnHover); }

    .sectionContent{
      display:none;
      border:1px dashed var(--line);
      border-radius:12px;
      padding:12px;
      margin-top:10px;
      background:#0f1222;
    }
    .sectionContent.open{ display:block; }

    .note{
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
    }

    /* Simple grid for inputs */
    .grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:12px;
      margin-top:12px;
    }
    label{ display:block; font-weight:700; margin-bottom:6px; }
    input{
      width:100%;
      padding:10px;
      border-radius:10px;
      border:1px solid var(--line);
      background:#0b0e1c;
      color:var(--text);
      font-size:16px;
    }
    input[readonly]{ opacity:.85; }

    @media (max-width:700px){
      .grid{ grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>

  <!-- TOP SCROLL BAR -->
  <div class="topTabs" id="topTabs">
    <button class="tabBtn active" data-target="settingsPage">Settings</button>
    <button class="tabBtn" data-target="tripPage">Trip</button>
    <button class="tabBtn" data-target="scenarioPage">Scenario</button>
    <button class="tabBtn" data-target="actualPage">Actual</button>
    <button class="tabBtn" data-target="businessPage">Business</button>
    <button class="tabBtn" data-target="reservesPage">Reserves</button>
    <button class="tabBtn" data-target="totalsPage">Totals</button>
    <button class="tabBtn" data-target="dnaPage">Yearly DNA</button>
    <button class="tabBtn" data-target="otraffPage">O.T.R.A.F.F</button>
    <button class="tabBtn" data-target="plPage">Profit / Loss</button>
  </div>

  <div class="wrap">
    <div class="card">
      <div class="headerBar">
        <h1>Trucking Made Simple</h1>
        <div class="sub">Scenario Calculator ‚Ä¢ Revenue ‚Ä¢ O.T.R.A.F.F ‚Ä¢ Time Away From Family</div>
        <div class="headerDivider"></div>
      </div>

      <!-- ===================== TAB PAGES START (ALL SIBLINGS) ===================== -->

<div id="settingsPage" class="tabPage activePage">
  <h3>Settings</h3>

  <div class="note">
    üîí Settings control <strong>preferences and defaults only</strong>.<br>
    They do <strong>not</strong> change Scenario math, formulas, or historical truth.
  </div>

  <div class="divider"></div>

  <!-- ================= BUSINESS RESERVE DEFAULTS ================= -->
  <button class="sectionBtn" type="button" onclick="toggleSection('settingsBusinessReserveSection')">
    üíº Business Reserve Defaults (tap to open / close)
  </button>

  <div id="settingsBusinessReserveSection" class="sectionContent">
    <div class="note">
      These are your <strong>target rules</strong> for how you like to run your truck.<br>
      Scenario and Actual calculations may differ based on reality.
    </div>

    <div class="grid">
      <div>
        <label>Default Business Reserve %</label>
        <input id="setBusinessReservePct" type="number" placeholder="e.g. 18" />
        <div class="note">Used as a starting assumption only.</div>
      </div>

      <div>
        <label>Default Maintenance Slice %</label>
        <input id="setMaintenancePct" type="number" placeholder="e.g. 8" />
        <div class="note">Tires ‚Ä¢ oil ‚Ä¢ breakdown buffer.</div>
      </div>
    </div>
  </div>

  <!-- ================= DISPLAY & UX ================= -->
  <button class="sectionBtn" type="button" onclick="toggleSection('settingsDisplaySection')">
    üñ•Ô∏è Display & UX (tap to open / close)
  </button>

  <div id="settingsDisplaySection" class="sectionContent">
    <div class="note">
      These settings only affect how information is shown.
    </div>

    <div class="grid">
      <div>
        <label>
          <input type="checkbox" id="setDarkMode">
          Dark Mode
        </label>
      </div>

      <div>
        <label>
          <input type="checkbox" id="setTooltips" checked>
          Show explanations & tips
        </label>
      </div>
    </div>
  </div>

  <!-- ================= LOCK NOTICE ================= -->
  <div class="divider"></div>

  <div class="note">
    üîê <strong>Plain Lock Rule:</strong><br>
    If it affects money math, time math, or O.T.R.A.F.F ‚Äî it does not belong in Settings.

    <!-- ================= PLAIN LOCK NOTICE (HARD FENCE) ================= -->
  <div class="divider"></div>

  <div class="lockBox">
    <div class="lockTitle">üîí Plain Lock ‚Äî What Settings Can‚Äôt Change</div>
    <div class="note">
      Settings are <strong>preferences + defaults only</strong>.<br>
      They cannot modify:
      <ul class="lockList">
        <li>Scenario math / formulas</li>
        <li>O.T.R.A.F.F calculation</li>
        <li>Actual history / totals</li>
        <li>Locked constants used by the Blueprint</li>
      </ul>
      If it affects money math, time math, or truth ‚Äî it does not belong in Settings.
    </div>
  </div>

  <!-- ================= SAVE / RESET (PREFERENCES ONLY) ================= -->
  <div class="saveRow">
    <button class="sectionBtn" type="button" onclick="saveSettingsPlainLock()">
      üíæ Save Settings (Preferences Only)
    </button>

    <button class="sectionBtn" type="button" onclick="resetSettingsPlainLock()">
      ‚ôªÔ∏è Reset to Defaults
    </button>

    <div id="settingsSavedMsg" class="note" style="margin-top:8px;"></div>
  </div>

  <!-- ================= STORAGE KEYS (VERSIONED) ================= -->
  <!--
    PC-SETTINGS-LOCK v1.0 (storage)
    storageKey: TMS_SETTINGS_v1

    fields:
      - businessReservePct (number)
      - maintenancePct (number)
      - darkMode (boolean)
      - tooltips (boolean)

    rule:
      - Settings may store preferences only.
      - Settings never write to Scenario/Actual calculations or history.
  -->
  </div>
</div>

      <div id="tripPage" class="tabPage">
        <span class="badge">Locked constants: Avg Speed = 65 mph ‚Ä¢ DOT break = 30 min after 8 driving hours ‚Ä¢ Fuel stop min = 15 min</span>
        <div class="divider"></div>

        <h3>Trip (Data Entry)</h3>

        <div class="grid">
          <div>
            <label>Deadhead Miles</label>
            <input id="deadheadMiles" type="number" value="0" oninput="updateTotalMilesFromParts()" />
          </div>

          <div>
            <label>Loaded Miles</label>
            <input id="loadedMiles" type="number" value="0" oninput="updateTotalMilesFromParts()" />
          </div>

          <div>
            <label>Return Miles</label>
            <input id="returnMiles" type="number" value="0" oninput="updateTotalMilesFromParts()" />
          </div>

          <div>
            <label>Total Miles (auto)</label>
            <input id="totalMiles" type="number" readonly />
            <div class="note">Deadhead + Loaded + Return</div>

            <div class="divider"></div>

          <button class="sectionBtn" type="button" onclick="saveTripPlainLock()">
          üíæ Save Trip Miles (Data Entry Only)
          </button>

          <button class="sectionBtn" type="button" onclick="resetTripPlainLock()">
          ‚ôªÔ∏è Reset Trip Miles
          </button>

          <div id="tripSavedMsg" class="note" style="margin-top:8px;"></div>
          </div>
        </div>

        <button class="sectionBtn" type="button" onclick="toggleSection('tripHelpSection')">
          üß† What this means (tap to open / close)
        </button>
        <div id="tripHelpSection" class="sectionContent">
          <div class="note">
            Trip miles drive: fuel use, time away, and what your true hourly value is (O.T.R.A.F.F).
          </div>
        </div>
      </div>

      <div id="scenarioPage" class="tabPage">
        <h3>Scenario</h3>
      <div class="note">
  Scenario = estimate only. Editable assumptions ‚Üí locked truth.
</div>

<!-- ================= INPUTS (ONLY EDITABLE AREA) ================= -->
<div class="sectionContent open">
  <div class="note"><strong>Editable Inputs (Scenario Only)</strong></div>

  <div class="grid">
    <div>
      <label>Revenue ($)</label>
      <input id="scenRevenue" type="number" />
    </div>

    <div>
      <label>Deadhead Miles</label>
      <input id="scenDeadhead" type="number" />
    </div>

    <div>
      <label>Loaded Miles</label>
      <input id="scenLoaded" type="number" />
    </div>

    <div>
      <label>Return-to-Home Miles</label>
      <input id="scenReturn" type="number" />
    </div>
  </div>
</div>

<!-- ================= READ-ONLY TRUTH ================= -->
<div id="scenarioOutput" class="sectionContent open">
  <div class="note"><strong>Auto-Calculated (Read-Only)</strong></div>

  <div class="grid">
    <div>
      <label>Total Miles</label>
      <input id="scenTotalMiles" readonly />
    </div>

    <div>
      <label>Estimated MPG (Lifetime)</label>
      <input id="scenMPG" readonly />
    </div>

    <div>
      <label>Estimated Fuel Cost ($)</label>
      <input id="scenFuelCost" readonly />
    </div>

    <div>
      <label>Total Hours Away</label>
      <input id="scenHours" readonly />
    </div>

    <div>
      <label>O.T.R.A.F.F ($/hr)</label>
      <input id="scenOTRAFF" readonly />
    </div>

    <div>
      <label>Scenario Net ($)</label>
      <input id="scenNet" readonly />
    </div>
  </div>

  <div class="note" id="scenarioMessage"></div>
</div>

        <button class="sectionBtn" type="button" onclick="toggleSection('scenarioReserveSection')">
          üß∞ Scenario Reserves (tap to open / close)
        </button>
        <div id="scenarioReserveSection" class="sectionContent">
          <div class="note">Maintenance ‚Ä¢ Tax ‚Ä¢ Peace-of-Mind reserves calculated from Scenario.</div>
        </div>
      </div>

      <div id="actualPage" class="tabPage">
        <h3>Actual</h3>
        <div class="note">Actual = truth. Only Actual updates totals/history.</div>

        <button class="sectionBtn" type="button" onclick="toggleSection('actualReserveSection')">
          ‚úÖ Actual Reserves (tap to open / close)
        </button>
        <div id="actualReserveSection" class="sectionContent">
          <div class="note">Actual reserve deductions come from what really happened.</div>
        </div>
      </div>

      <div id="businessPage" class="tabPage">
        <h3>Business</h3>
        <div class="note">Truck & trailer payments ‚Ä¢ Insurance ‚Ä¢ Permits ‚Ä¢ Maintenance ‚Ä¢ Downtime</div>

        <button class="sectionBtn" type="button" onclick="toggleSection('businessReserveSection')">
          üíº Business Reserve (tap to open / close)
        </button>
        <div id="businessReserveSection" class="sectionContent">
          <div class="note">
            Business reserve section (Business page). This one is for business budgeting logic & education.
          </div>
        </div>
      </div>

      <div id="reservesPage" class="tabPage">
        <h3>Reserves</h3>
        <div class="note">Money set aside before take-home ‚Äî on purpose.</div>

        <button class="sectionBtn" type="button" onclick="toggleSection('reservesScenarioSection')">
          üß∞ Scenario Reserves (tap to open / close)
        </button>
        <div id="reservesScenarioSection" class="sectionContent">
          <div class="note">Scenario reserve display and explanations.</div>
        </div>
      </div>

      <div id="totalsPage" class="tabPage">
        <h3>Totals</h3>
        <div class="note">Monthly + YTD totals (Actual only).</div>
      </div>

      <div id="dnaPage" class="tabPage">
        <h3>Yearly DNA</h3>
        <div class="note">Your yearly patterns, strengths, and money leaks.</div>
      </div>

      <div id="otraffPage" class="tabPage">
        <h3>O.T.R.A.F.F</h3>
        <div class="note">On The Road Away From Family ‚Äî net revenue √∑ hours away.</div>
      </div>

      <div id="plPage" class="tabPage">
        <h3>Profit / Loss</h3>
        <div class="note">P/L view (Actual only).</div>
      </div>

      <!-- ===================== TAB PAGES END ===================== -->

    </div>
  </div>

  <script>
    // ---------- Helpers ----------
    function n(id){
      const el = document.getElementById(id);
      if (!el) return 0;
      const v = parseFloat(el.value);
      return isFinite(v) ? v : 0;
    }
    function setVal(id, v){
      const el = document.getElementById(id);
      if (el) el.value = v;
    }

    // ---------- Section Toggle (open/close) ----------
    function toggleSection(id){
      const section = document.getElementById(id);
      if (!section) return;
      section.classList.toggle("open");
    }

// ---------- Tabs ----------
document.addEventListener("DOMContentLoaded", () => {
  const tabButtons = Array.from(document.querySelectorAll(".tabBtn"));
  const tabPages   = Array.from(document.querySelectorAll(".tabPage"));

  function setActiveTab(targetId){
    tabButtons.forEach(b => b.classList.remove("active"));
    tabPages.forEach(p => p.classList.remove("activePage"));

    const btn  = tabButtons.find(b => b.dataset.target === targetId);
    const page = document.getElementById(targetId);

    if (btn)  btn.classList.add("active");
    if (page) page.classList.add("activePage");

    // üîí AUTO-RUN SCENARIO WHEN SCENARIO TAB BECOMES ACTIVE
    if (targetId === "scenarioPage"){
      runScenario();
    }
  }

  // üîó CLICK HANDLERS (THIS IS WHAT MAKES TABS CLICKABLE)
  tabButtons.forEach(btn => {
    btn.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      const targetId = btn.dataset.target;
      if (!targetId) return;
      setActiveTab(targetId);
      window.scrollTo({ top: 0, behavior: "smooth" });
    }, { passive:false });
  });

  // Default tab (uses whichever button is marked .active first)
  const defaultTarget =
    document.querySelector(".tabBtn.active")?.dataset.target ||
    tabButtons[0]?.dataset.target;

  if (defaultTarget) setActiveTab(defaultTarget);

  // initialize miles
  updateTotalMilesFromParts();

    // üîÅ AUTO-RECALCULATE SCENARIO WHEN INPUTS CHANGE
  ["scenRevenue","scenDeadhead","scenLoaded","scenReturn"].forEach(id => {
    const el = document.getElementById(id);
    if (el){
      el.addEventListener("input", runScenario);
    }
  });
});
    
    // ---------- Example Trip calc ----------
    function updateTotalMilesFromParts(){
      const total = n("deadheadMiles") + n("loadedMiles") + n("returnMiles");
      setVal("totalMiles", total);
    }

const SCENARIO_PLAIN_CODE = {
  avgSpeed: 65,            // mph
  fuelPrice: 3.75,         // placeholder (later auto-pull)
  lifetimeMPG: 6.8,        // placeholder lifetime actual
  fuelStopMinutes: 15,
  dotBreakHours: 8,
  reserveRate: 0.18        // total reserves
};

function runScenario(){
  // --- Editable inputs ---
  const revenue   = n("scenRevenue");
  const deadhead  = n("scenDeadhead");
  const loaded    = n("scenLoaded");
  const rtn       = n("scenReturn");

  // --- Total miles ---
  const totalMiles = deadhead + loaded + rtn;
  setVal("scenTotalMiles", totalMiles);

  if (totalMiles <= 0 || revenue <= 0){
    document.getElementById("scenarioMessage").textContent =
      "Enter revenue and miles to evaluate Scenario.";
    clearScenarioOutputs();
    return;
  }

  // --- MPG (locked from lifetime actual) ---
  const mpg = SCENARIO_PLAIN_CODE.lifetimeMPG;
  setVal("scenMPG", mpg.toFixed(2));

  // --- Fuel cost ---
  const fuelCost =
    (totalMiles / mpg) * SCENARIO_PLAIN_CODE.fuelPrice;
  setVal("scenFuelCost", fuelCost.toFixed(2));

  // --- Time calculation ---
  const driveHours = totalMiles / SCENARIO_PLAIN_CODE.avgSpeed;
  const dotBreaks =
    Math.floor(driveHours / SCENARIO_PLAIN_CODE.dotBreakHours) * 0.5;
  const fuelStops =
    Math.max(1, Math.floor(totalMiles / 500)) *
    (SCENARIO_PLAIN_CODE.fuelStopMinutes / 60);

  const totalHours = driveHours + dotBreaks + fuelStops;
  setVal("scenHours", totalHours.toFixed(2));

  // --- Net + OTRAF ---
  const reserves = revenue * SCENARIO_PLAIN_CODE.reserveRate;
  const net = revenue - fuelCost - reserves;
  const otraff = net / totalHours;

  setVal("scenNet", net.toFixed(2));
  setVal("scenOTRAFF", otraff.toFixed(2));

  document.getElementById("scenarioMessage").textContent =
    "Scenario calculated automatically (estimate only).";
}

function clearScenarioOutputs(){
  [
    "scenTotalMiles",
    "scenMPG",
    "scenFuelCost",
    "scenHours",
    "scenOTRAFF",
    "scenNet"
  ].forEach(id => setVal(id, ""));
}
    
// =====================
// üîí PLAIN LOCK SETTINGS v1.0 (PREFERENCES ONLY)
// =====================
const TMS_SETTINGS_STORAGE_KEY = "TMS_SETTINGS_v1";

const TMS_SETTINGS_DEFAULTS = {
  businessReservePct: 18,
  maintenancePct: 8,
  darkMode: false,
  tooltips: true
};

function getSettingsInputs(){
  return {
    businessReservePctEl: document.getElementById("setBusinessReservePct"),
    maintenancePctEl: document.getElementById("setMaintenancePct"),
    darkModeEl: document.getElementById("setDarkMode"),
    tooltipsEl: document.getElementById("setTooltips"),
    msgEl: document.getElementById("settingsSavedMsg")
  };
}

function loadSettingsPlainLock(){
  const { businessReservePctEl, maintenancePctEl, darkModeEl, tooltipsEl } = getSettingsInputs();
  if (!businessReservePctEl || !maintenancePctEl || !darkModeEl || !tooltipsEl) return;

  let saved = null;
  try {
    saved = JSON.parse(localStorage.getItem(TMS_SETTINGS_STORAGE_KEY) || "null");
  } catch (e) {
    saved = null;
  }

  const s = { ...TMS_SETTINGS_DEFAULTS, ...(saved || {}) };

  businessReservePctEl.value = s.businessReservePct;
  maintenancePctEl.value = s.maintenancePct;
  darkModeEl.checked = !!s.darkMode;
  tooltipsEl.checked = !!s.tooltips;

  // Optional UI application (safe)
  document.body.classList.toggle("darkMode", !!s.darkMode);
}

function saveSettingsPlainLock(){
  const { businessReservePctEl, maintenancePctEl, darkModeEl, tooltipsEl, msgEl } = getSettingsInputs();
  if (!businessReservePctEl || !maintenancePctEl || !darkModeEl || !tooltipsEl) return;

  const businessReservePct = Number(businessReservePctEl.value);
  const maintenancePct = Number(maintenancePctEl.value);

  // Guardrails (preferences only)
  const safe = {
    businessReservePct: isFinite(businessReservePct) ? Math.max(0, Math.min(40, businessReservePct)) : TMS_SETTINGS_DEFAULTS.businessReservePct,
    maintenancePct: isFinite(maintenancePct) ? Math.max(0, Math.min(40, maintenancePct)) : TMS_SETTINGS_DEFAULTS.maintenancePct,
    darkMode: !!darkModeEl.checked,
    tooltips: !!tooltipsEl.checked
  };

  localStorage.setItem(TMS_SETTINGS_STORAGE_KEY, JSON.stringify(safe));

  // Apply UI-only effects
  document.body.classList.toggle("darkMode", safe.darkMode);

  if (msgEl){
    msgEl.textContent = "‚úÖ Saved. (Preferences only ‚Äî math is locked.)";
  }
}

function resetSettingsPlainLock(){
  localStorage.setItem(TMS_SETTINGS_STORAGE_KEY, JSON.stringify(TMS_SETTINGS_DEFAULTS));
  loadSettingsPlainLock();
  const { msgEl } = getSettingsInputs();
  if (msgEl){
    msgEl.textContent = "‚ôªÔ∏è Reset to defaults. (Preferences only ‚Äî math is locked.)";
  }
}

// Load settings at startup (does not touch Scenario/Actual math)
document.addEventListener("DOMContentLoaded", () => {
  loadSettingsPlainLock();
});

// =====================
// üîí PLAIN LOCK TRIP v1.0 (DATA ENTRY ONLY)
// =====================
// Trip page is for miles entry + education only.
// It does NOT change Scenario/Actual formulas by itself.
// It may store and recall trip miles between sessions.

const TMS_TRIP_STORAGE_KEY = "TMS_TRIP_v1";

const TMS_TRIP_DEFAULTS = {
  deadheadMiles: 0,
  loadedMiles: 0,
  returnMiles: 0
};

// Safety caps (prevents wild typos)
const TMS_TRIP_LIMITS = {
  min: 0,
  max: 5000
};

function clampNumber(v, min, max){
  const num = Number(v);
  if (!isFinite(num)) return min;
  return Math.max(min, Math.min(max, num));
}

function getTripInputs(){
  return {
    deadheadEl: document.getElementById("deadheadMiles"),
    loadedEl: document.getElementById("loadedMiles"),
    returnEl: document.getElementById("returnMiles"),
    totalEl: document.getElementById("totalMiles"),
    msgEl: document.getElementById("tripSavedMsg")
  };
}

function readTripFromUI(){
  const { deadheadEl, loadedEl, returnEl } = getTripInputs();
  if (!deadheadEl || !loadedEl || !returnEl) return { ...TMS_TRIP_DEFAULTS };

  return {
    deadheadMiles: clampNumber(deadheadEl.value, TMS_TRIP_LIMITS.min, TMS_TRIP_LIMITS.max),
    loadedMiles: clampNumber(loadedEl.value,   TMS_TRIP_LIMITS.min, TMS_TRIP_LIMITS.max),
    returnMiles: clampNumber(returnEl.value,   TMS_TRIP_LIMITS.min, TMS_TRIP_LIMITS.max)
  };
}

function writeTripToUI(t){
  const { deadheadEl, loadedEl, returnEl } = getTripInputs();
  if (!deadheadEl || !loadedEl || !returnEl) return;

  deadheadEl.value = t.deadheadMiles;
  loadedEl.value   = t.loadedMiles;
  returnEl.value   = t.returnMiles;

  // Recalculate Total Miles using your existing function
  if (typeof updateTotalMilesFromParts === "function"){
    updateTotalMilesFromParts();
  }
}

function loadTripPlainLock(){
  let saved = null;
  try {
    saved = JSON.parse(localStorage.getItem(TMS_TRIP_STORAGE_KEY) || "null");
  } catch (e) {
    saved = null;
  }

  const t = { ...TMS_TRIP_DEFAULTS, ...(saved || {}) };

  // Clamp again in case storage had bad data
  const safe = {
    deadheadMiles: clampNumber(t.deadheadMiles, TMS_TRIP_LIMITS.min, TMS_TRIP_LIMITS.max),
    loadedMiles:   clampNumber(t.loadedMiles,   TMS_TRIP_LIMITS.min, TMS_TRIP_LIMITS.max),
    returnMiles:   clampNumber(t.returnMiles,   TMS_TRIP_LIMITS.min, TMS_TRIP_LIMITS.max)
  };

  writeTripToUI(safe);
  showTripWarningsPlainLock(safe);
}

function saveTripPlainLock(){
  const { msgEl } = getTripInputs();
  const safe = readTripFromUI();

  // Normalize UI to clamped values (so user sees the ‚Äútruth‚Äù)
  writeTripToUI(safe);

  localStorage.setItem(TMS_TRIP_STORAGE_KEY, JSON.stringify(safe));

  showTripWarningsPlainLock(safe);

  if (msgEl){
    msgEl.textContent = "‚úÖ Saved Trip miles. (Data entry only ‚Äî no math changed.)";
  }
}

function resetTripPlainLock(){
  localStorage.setItem(TMS_TRIP_STORAGE_KEY, JSON.stringify(TMS_TRIP_DEFAULTS));
  loadTripPlainLock();

  const { msgEl } = getTripInputs();
  if (msgEl){
    msgEl.textContent = "‚ôªÔ∏è Reset Trip miles to defaults.";
  }
}

// üîí Plain Lock Guardrail: warn if Return is unusually large
function showTripWarningsPlainLock(t){
  const { msgEl } = getTripInputs();
  if (!msgEl) return;

  // If return >= loaded and loaded > 0, show a confirmation-style warning
  if (t.loadedMiles > 0 && t.returnMiles >= t.loadedMiles){
    msgEl.textContent =
      "‚ö†Ô∏è Heads up: Return Miles is >= Loaded Miles. That may be correct ‚Äî just double-check.";
  }
}

// Auto-save on typing (Trip only)
document.addEventListener("DOMContentLoaded", () => {
  loadTripPlainLock();

  const { deadheadEl, loadedEl, returnEl } = getTripInputs();
  [deadheadEl, loadedEl, returnEl].forEach(el => {
    if (!el) return;
    el.addEventListener("input", () => {
      // Keep Total Miles live (you already do this oninput, but this is a safe fallback)
      if (typeof updateTotalMilesFromParts === "function"){
        updateTotalMilesFromParts();
      }
      // Save Trip entries without touching Scenario/Actual math
      saveTripPlainLock();
    });
  });
});
  </script>

</body>
</html>
