<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Trucking Made Simple – Scenario (DOT/HOS)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial, sans-serif; background:#f6f6f6; padding:20px; }
    .card {
      max-width: 760px;
      margin: auto;
      background:#fff;
      padding:20px;
      border-radius:8px;
      box-shadow:0 2px 6px rgba(0,0,0,0.1);
    }
    h1 { margin: 0 0 6px 0; }
    h3 { margin: 0 0 16px 0; font-weight: normal; color:#333; }
    .grid { display:grid; grid-template-columns: 1fr 1fr; gap: 14px 18px; }
    @media (max-width: 720px) { .grid { grid-template-columns: 1fr; } }
    label { font-weight: bold; display:block; margin-top: 2px; }
    input {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      box-sizing: border-box;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }
    input[readonly] { background:#eee; }
    .note { font-size: 12px; color:#666; margin-top:6px; line-height: 1.3; }
    .row { margin-top: 12px; }
    button {
      margin-top: 18px;
      padding: 12px;
      width: 100%;
      font-size: 16px;
      cursor: pointer;
      border-radius: 8px;
      border: 1px solid #bbb;
      background: #f2f2f2;
    }
    .badge {
      display:inline-block;
      padding: 6px 10px;
      border-radius: 999px;
      background:#f0f0f0;
      font-size: 12px;
      margin-top: 10px;
    }
    .divider {
      height: 1px;
      background: #e6e6e6;
      margin: 18px 0;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>Trucking Made Simple</h1>
    <h3>Scenario Calculator (Fuel + DOT/HOS + Hours Away)</h3>

    <span class="badge">Locked constants: Avg Speed = 65 mph • DOT break = 30 min after 8 driving hours • Max driving/day = 11 hr • Reset = 10 hr</span>

    <div class="divider"></div>

    <div class="grid">
      <!-- INPUTS -->
      <div>
  <label>Deadhead Miles (input)</label>
  <input id="deadheadMiles" type="number" value="0" oninput="updateTotalMilesFromParts()" />
</div>

<div>
  <label>Loaded Miles (input)</label>
  <input id="loadedMiles" type="number" value="0" oninput="updateTotalMilesFromParts()" />
</div>

<div>
  <label>Return Miles (input)</label>
  <input id="returnMiles" type="number" value="0" oninput="updateTotalMilesFromParts()" />
</div>

<div>
  <label>Total Miles (auto)</label>
  <input id="totalMiles" type="number" readonly />
  <div class="note">Deadhead + Loaded + Return</div>
</div>

      <div>
        <label>Lifetime Avg MPG (read-only)</label>
        <input id="lifetimeMpg" type="number" value="7" readonly />
        <div class="note">From Actual fuel history</div>
      </div>

      <label>Avg MPG (Scenario) (read-only)</label>
<input id="scenarioMpg" type="number" readonly />
<div class="note">Always mirrors Lifetime MPG</div>
      

      <div>
        <label>Tank Capacity (gallons) (input)</label>
        <input id="tankCapacity" type="number" value="120" />
      </div>

      <div>
        <label>Fuel Stop Minutes (input)</label>
        <input id="fuelStopMinutes" type="number" value="15" />
        <div class="note">Minimum 15 minutes per stop (MVP default)</div>
      </div>

      <div>
        <label>Wait / Unload Time (hours) (input)</label>
        <input id="waitHours" type="number" value="0" step="0.25" />
        <div class="note">Counts as On-Duty time</div>
      </div>
<div>
  <label>Revenue (input)</label>
  <input id="revenue" type="number" value="0" step="0.01" />
  <div class="note">Gross trip pay</div>
</div>
<div>
  <label>Fuel Price ($/gal) (input)</label>
  <input id="fuelPrice" type="number" value="0" step="0.01" />
  <div class="note">Used to estimate fuel cost</div>
</div>
<div>
  <label>Other Trip Costs (input)</label>
  <input id="otherCosts" type="number" value="0" step="0.01" />
  <div class="note">Tolls, lumper, etc. (optional)</div>
</div>
      <!-- RESERVES / WITHHOLDINGS (inputs) -->

<div>
  <label>Maintenance Reserve (%)</label>
  <input id="reserveMaintPct" type="number" value="10" step="0.1" />
  <div class="note">% of Net Revenue</div>
</div>

<div>
  <label>Tax Reserve (%)</label>
  <input id="reserveTaxPct" type="number" value="25" step="0.1" />
  <div class="note">% of Net Revenue</div>
</div>

<div>
  <label>Peace of Mind Reserve (%)</label>
  <input id="reservePeacePct" type="number" value="5" step="0.1" />
  <div class="note">% of Net Revenue</div>
</div>

<div>
  <label>Household Withholding ($)</label>
  <input id="householdWithhold" type="number" value="0" step="1" />
  <div class="note">Optional fixed amount to pull off this trip</div>
</div>
      

<!-- RESERVES / WITHHOLDINGS (outputs) -->
<div>
  <label>Maintenance Reserve ($)</label>
  <input id="reserveMaint" type="number" readonly />
  <div class="note">Net Revenue × Maintenance %</div>
</div>

<div>
  <label>Tax Reserve ($)</label>
  <input id="reserveTax" type="number" readonly />
  <div class="note">Net Revenue × Tax %</div>
</div>

<div>
  <label>Peace of Mind Reserve ($)</label>
  <input id="reservePeace" type="number" readonly />
  <div class="note">Net Revenue × Peace %</div>
</div>

<div>
  <label>Total Withheld ($)</label>
  <input id="totalWithheld" type="number" readonly />
  <div class="note">Maintenance + Tax + Peace + Household</div>
</div>

<div>
  <label>Take-Home After Withholds ($)</label>
  <input id="takeHome" type="number" readonly />
  <div class="note">Net Revenue − Total Withheld</div>
</div>

<div>
  <label>O.T.R.A.F.F After Withholds ($/hr away)</label>
  <input id="otrafTakeHome" type="number" readonly />
  <div class="note">Take-Home ÷ Total Hours Away</div>
</div>
      <div>
        <label>Status (read-only)</label>
        <input id="status" type="text" readonly />
        <div class="note">Tells you what’s missing</div>
      </div>

      <!-- OUTPUTS -->
      <div>
        <label>Estimated Gallons Needed (read-only)</label>
        <input id="gallonsNeeded" type="number" readonly />
      </div>
<div>
  <label>Estimated Fuel Cost (read-only)</label>
  <input id="fuelCost" type="number" readonly />
  <div class="note">Estimated Gallons Needed × Fuel Price</div>
</div>
      <div>
        <label>Fuel Stops (read-only)</label>
        <input id="fuelStops" type="number" readonly />
        <div class="note">ceil(gallons ÷ tank) − 1 (min 0)</div>
      </div>

      <div>
        <label>Fuel Stop Time (hours) (read-only)</label>
        <input id="fuelStopHours" type="number" readonly />
        <div class="note">fuelStops × minutes ÷ 60</div>
      </div>

      <div>
        <label>Driving Hours (read-only)</label>
        <input id="drivingHours" type="number" readonly />
        <div class="note">Total Miles ÷ 65 mph</div>
      </div>

      <div>
        <label>DOT Break (hours) (read-only)</label>
        <input id="dotBreakHours" type="number" readonly />
        <div class="note">0.5 hr if Driving Hours &gt; 8</div>
      </div>

      <div>
        <label>Duty Days (read-only)</label>
        <input id="dutyDays" type="number" readonly />
        <div class="note">ceil(Driving Hours ÷ 11)</div>
      </div>

      <div>
        <label>Reset Time (hours) (read-only)</label>
        <input id="resetHours" type="number" readonly />
        <div class="note">(Duty Days − 1) × 10</div>
      </div>

      <div>
        <label>Total Hours Away (Scenario) (read-only)</label>
        <input id="totalHoursAway" type="number" readonly />
        <div class="note">Driving + DOT Break + Fuel Stop Time + Wait + Reset</div>
      </div>
    </div>
<div>
  <label>Net Revenue (Scenario) (read-only)</label>
  <input id="netRevenue" type="number" readonly />
  <div class="note">Revenue - Other Trip Costs (fuel not subtracted in this step)</div>
</div>

<div>
  <label>$ / Mile (Scenario) (read-only)</label>
  <input id="netPerMile" type="number" readonly />
  <div class="note">Net Revenue ÷ Total Miles</div>
</div>

<div>
  <label>O.T.R.A.F.F ($/hr away) (Scenario) (read-only)</label>
  <input id="otraf" type="number" readonly />
  <div class="note">Net Revenue ÷ Total Hours Away</div>
</div>
    <div class="row" style="margin-top:12px;">
  <div>
    <label>Mode</label>
    <select id="mode" onchange="syncModeUI()">
      <option value="scenario" selected>Scenario</option>
      <option value="actual">Actual (locked until Delivered)</option>
    </select>
    <div class="note">Scenario is always available. Actual unlocks after Delivered.</div>
  </div>

  <div>
    <label>Trip Status</label>
    <select id="tripStatus" onchange="syncModeUI()">
      <option value="planning" selected>Planning</option>
      <option value="accepted">Accepted</option>
      <option value="delivered">Delivered (unlocks Actual)</option>
    </select>
    <div class="note">Actual mode is read-only until Delivered.</div>
  </div>
</div>
    <button onclick="runScenario()">Run Scenario</button>
  </div>

  
    

<script>
/* ===============================
   Trucking Made Simple — Scenario Engine (Option B)
   RULE: Scenario ALWAYS uses Lifetime MPG
   =============================== */

const AVG_SPEED_MPH = 65;       // locked
const DOT_BREAK_HOURS = 0.5;    // locked: 30 minutes
const MAX_DRIVE_PER_DAY = 11;   // locked
const RESET_HOURS = 10;         // locked

function ceil(n) { return Math.ceil(n); }
function round2(n) { return Math.round((n + Number.EPSILON) * 100) / 100; }

function getEl(id) { return document.getElementById(id); }
function num(id) {
  const el = getEl(id);
  if (!el) return NaN;
  return Number(el.value);
}
function setVal(id, v) {
  const el = getEl(id);
  if (!el) return;
  el.value = v;
}
function setFirst(ids, v) {
  for (const id of ids) {
    const el = getEl(id);
    if (el) { el.value = v; return; }
  }
}

/* Keeps UI rules: Actual locked until Delivered */
function syncModelUI() {
  const modeEl = getEl("mode");
  const tripEl = getEl("tripStatus");
  if (!modeEl || !tripEl) return;

  const mode = modeEl.value;
  const trip = tripEl.value;

  // lock actual until delivered
  if (mode === "actual" && trip !== "delivered") {
    modeEl.value = "scenario";
    setVal("status", "Actual locked until Delivered");
  } else {
    // don’t overwrite status if it already shows validation text
    const s = getEl("status");
    if (s && !s.value) s.value = "OK";
  }
}

/* Time engine */
function calculateScenarioTime({ totalMiles, fuelStopTimeHours, waitUnloadHours }) {
  const drivingHours = totalMiles / AVG_SPEED_MPH;
  const dotBreakHours = drivingHours > 8 ? DOT_BREAK_HOURS : 0;

  const dutyDays = ceil(drivingHours / MAX_DRIVE_PER_DAY);
  const resetHours = Math.max((dutyDays - 1) * RESET_HOURS, 0);

  const totalHoursAway =
    drivingHours +
    dotBreakHours +
    (fuelStopTimeHours || 0) +
    (waitUnloadHours || 0) +
    resetHours;

  const loadDaysConsumed = totalHoursAway / 24;

  return {
    drivingHours: round2(drivingHours),
    dotBreakHours: round2(dotBreakHours),
    dutyDays,
    resetHours: round2(resetHours),
    totalHoursAway: round2(totalHoursAway),
    loadDaysConsumed: round2(loadDaysConsumed),
    status: "OK"
  };
}

function clearOutputs() {
  setVal("status", "");
  setFirst(["mpgUsed"], "");
  setFirst(["estimatedGallons", "gallonsNeeded"], "");
  setFirst(["fuelStops"], "");
  setFirst(["fuelStopHours", "fuelStopTimeHours"], "");
  setFirst(["drivingHours"], "");
  setFirst(["dotBreakHours", "dotBreakHour"], "");
  setFirst(["dutyDays"], "");
  setFirst(["resetHours"], "");
  setFirst(["totalHoursAway"], "");
  
  setFirst(["loadDaysConsumed"], "");
  // keep scenarioMpg mirror consistent
  setVal("scenarioMpg", "");
}
function updateTotalMilesFromParts() {
  const deadhead = Number(document.getElementById("deadheadMiles")?.value || 0);
  const loaded   = Number(document.getElementById("loadedMiles")?.value || 0);
  const ret      = Number(document.getElementById("returnMiles")?.value || 0);

  const total = deadhead + loaded + ret;

  const totalEl = document.getElementById("totalMiles");
  if (totalEl) totalEl.value = total;
}

  function runScenario() {
  // read inputs
  const totalMiles = num("totalMiles");
  const lifetimeMpg = num("lifetimeMpg");
  const tankCapacity = num("tankCapacity");
  const fuelStopMinutes = num("fuelStopMinutes");
  const waitHours = num("waitHours");

  // basic validation
  if (!isFinite(totalMiles) || totalMiles <= 0) {
    setVal("status", "Enter Total Miles > 0");
    clearOutputs();
    return;
  }
  if (!isFinite(lifetimeMpg) || lifetimeMpg <= 0) {
    setVal("status", "Lifetime MPG must be > 0");
    clearOutputs();
    return;
  }
  if (!isFinite(tankCapacity) || tankCapacity <= 0) {
    setVal("status", "Tank Capacity must be > 0");
    clearOutputs();
    return;
  }
  if (!isFinite(fuelStopMinutes) || fuelStopMinutes <= 0) {
    setVal("status", "Fuel Stop Minutes must be > 0");
    clearOutputs();
    return;
  }
  if (!isFinite(waitHours) || waitHours < 0) {
    setVal("status", "Wait/Unload must be 0 or more");
    clearOutputs();
    return;
  }

  // OPTION B: LOCKED MPG
  const mpgUsed = lifetimeMpg;

  // mirror scenario MPG display (read-only)
  setVal("scenarioMpg", mpgUsed.toFixed(2));
  setFirst(["mpgUsed"], mpgUsed.toFixed(2));

  // fuel math
  const gallonsNeeded = totalMiles / mpgUsed;
  const fuelStops = Math.max(ceil(gallonsNeeded / tankCapacity) - 1, 0);
  const fuelStopTimeHours = (fuelStops * fuelStopMinutes) / 60;

  setFirst(["estimatedGallons", "gallonsNeeded"], gallonsNeeded.toFixed(2));
  // fuel cost math
const fuelPrice = num("fuelPrice");
const fuelCost = gallonsNeeded * fuelPrice;
setVal("fuelCost", isFinite(fuelCost) ? fuelCost.toFixed(2) : "");
    setFirst(["fuelStops"], String(fuelStops));
  setFirst(["fuelStopHours", "fuelStopTimeHours"], fuelStopTimeHours.toFixed(2));

  // time math
  const time = calculateScenarioTime({
    totalMiles,
    fuelStopTimeHours,
    waitUnloadHours: waitHours
  });

  setFirst(["drivingHours"], time.drivingHours.toFixed(2));
  setFirst(["dotBreakHours"], time.dotBreakHours.toFixed(2));
  setFirst(["dutyDays"], String(time.dutyDays));
  setFirst(["resetHours"], time.resetHours.toFixed(2));
  setFirst(["totalHoursAway"], time.totalHoursAway.toFixed(2));
// --- Revenue + Fuel + Costs + O.T.R.A.F.F (Scenario) ---
const revenue = num("revenue");
const otherCosts = num("otherCosts");

// fuel cost (already computed above in your code)
// const fuelCost = ... (keep your fuelCost math above)

// Net Revenue = Revenue - Fuel Cost - Other Trip Costs
const netRevenue = revenue - fuelCost - otherCosts;
setVal("netRevenue", isFinite(netRevenue) ? netRevenue.toFixed(2) : "");

// $/mile = Net Revenue ÷ Total Miles
const netPerMile = netRevenue / totalMiles;
setVal("netPerMile", isFinite(netPerMile) ? netPerMile.toFixed(2) : "");

// O.T.R.A.F.F = Net Revenue ÷ Total Hours Away
const otraf = netRevenue / time.totalHoursAway;
setVal("otraf", isFinite(otraf) ? otraf.toFixed(2) : "");

// --- RESERVES / WITHHOLDS (Scenario) ---
const reserveMaintPct = num("reserveMaintPct") / 100;
const reserveTaxPct   = num("reserveTaxPct") / 100;
const reservePeacePct = num("reservePeacePct") / 100;

// Household fixed withholding (optional)
const householdWithhold = num("householdWithhold");

// Reserve $ amounts (based on Net Revenue)
const reserveMaint = netRevenue * reserveMaintPct;
const reserveTax   = netRevenue * reserveTaxPct;
const reservePeace = netRevenue * reservePeacePct;

setVal("reserveMaint", isFinite(reserveMaint) ? reserveMaint.toFixed(2) : "");
setVal("reserveTax",   isFinite(reserveTax) ? reserveTax.toFixed(2) : "");
setVal("reservePeace", isFinite(reservePeace) ? reservePeace.toFixed(2) : "");

// Total withheld = reserves + household withholding
const totalWithheld = reserveMaint + reserveTax + reservePeace + householdWithhold;
setVal("totalWithheld", isFinite(totalWithheld) ? totalWithheld.toFixed(2) : "");

// Take-home after withholds
const takeHome = netRevenue - totalWithheld;
setVal("takeHome", isFinite(takeHome) ? takeHome.toFixed(2) : "");

// O.T.R.A.F.F after withholds = Take-home ÷ Total Hours Away
const otrafTakeHome = takeHome / time.totalHoursAway;
setVal("otrafTakeHome", isFinite(otrafTakeHome) ? otrafTakeHome.toFixed(2) : "");

// keep your existing status behavior
if (time.status === "OK") setVal("status", "OK");
    
}

// Run once at load
syncModelUI();
runScenario();
  </script>
  </body>
</html>
  
